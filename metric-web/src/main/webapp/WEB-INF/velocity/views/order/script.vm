<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <script src="${rc.contextPath}/_resources/js/plugins/layer/laydate/laydate.js"></script>
    <script src="${rc.contextPath}/_resources/lhgdialog/lhgdialog.js"></script>
    <script src="${rc.contextPath}/_resources/lhgdialog/lhgdialog.min.js"></script>
    <link href="${rc.contextPath}/_resources/css/bootstrap-select.css" rel="stylesheet">
    <script src="${rc.contextPath}/_resources/js/bootstrap-select.js"></script>
</head>
<body class="gray-bg">
<div class="ibox-content">
    <button class="btn btn-success" type="button" onclick="detail()"><i class="glyphicon glyphicon-plus"></i>新建</button>
    <form role="form" class="form-horizontal">
        <div class="form-group">
            <label class="col-sm-3 control-label">脚本名称: </label>
            <div class="col-sm-8" style="width:430px">
                <select name="id" id="id" class="selectpicker show-tick form-control" data-live-search="true" onchange="changeScript()">
                    #foreach(${script} in ${scripts})
                    <option value="$!{script.id}">$!{script.name}</option>
                    #end
                </select>
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">脚本内容</label>
            <div class="col-sm-8">
                <textarea id="script" name="script" placeholder="这里输入脚本内容" style="width:500px;height:400px"></textarea>
            </div>
        </div>
    </form>
</div>
<div align="center">
    <div class="col-lg-12" >
        <button type="button" class="btn btn-primary" onclick="runScript()"><i class="glyphicon glyphicon-play-circle"></i>立即执行</button>
        <button type="button" class="btn btn-info" onclick="saveScript()"><i class="glyphicon glyphicon-saved"></i>保存</button>
        <button type="button" class="btn btn-danger" onclick="clearScript()"><i class="glyphicon glyphicon-trash"></i>清除</button>
    </div>
</div>
<script>
function runScript() {
    var script = encodeURIComponent(document.getElementById("script").value);
    window.open("run.html?script=" + script);
}
function detail(){
   layer.open({
     type: 2,
     area: ['800px', '320px'],
     fixed: false,
     maxmin: true,
     content: 'detail.html',
   });
}
function changeScript() {
    var id = $('#id option:selected').val();
    $.ajax({
        type: "POST",
        url:"change.html?id=" + id,
        dataType:"json",
        success: function(data) {
            if(data.code == 1){
               document.getElementById("script").value = data.data;
            }else{
               layer.msg(data.msg,failIcon);
            }
        }
    });
}
function saveScript(){
    var id = $('#id option:selected').val();
    var script = encodeURIComponent(document.getElementById("script").value);
    if (id == '') {
        layer.msg("请选择脚本",failIcon);
        return;
    }
    if (script == '') {
        layer.msg("请输入脚本内容",failIcon);
        return;
    }
    $.ajax({
        type: "POST",
        url:"save.html?id=" + id + "&script=" + script,
        success: function(data) {
           data = eval('(' + data + ')');
           if(data.code == 1){
               closeLayer(data.msg);
           }else{
               layer.msg(data.msg,failIcon);
           }
        }
    });
}
function clearScript() {
    document.getElementById("script").value = '';
}
$(document).ready(function() {
    changeScript();
});
</script>
</body>
</html>