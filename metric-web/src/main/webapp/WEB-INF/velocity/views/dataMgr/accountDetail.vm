<script src="${rc.contextPath}/_resources/js/jquery.md5.js"></script>
<script src="${rc.contextPath}/_resources/js/plugins/layer/laydate/laydate.js"></script>
<div class="ibox-content">
    <form role="form" id="accountDetailForm" class="form-inline" action="">
        <div class="form-group">
            <label>用户名:</label><input type="text" id="userName" name="userName" class="form-control">
            <label>渠道名称:</label><input type="text" id="userId" name="realName" class="form-control">
            <label>变动类型</label>
            <select name="type" id="type" class="form-control" style="width:130px;height:33px">
                <option value="-1">全部</option>
                #foreach(${_type} in ${accountDetailType})
                <option value="$!{_type.value}" hassubinfo="true">$!{_type.name}</option>
                #end
            </select>
        </div>
        <br><br>
        <div class="form-group">
            <label>变动原因:</label>
            <select name="itemType" id="itemType" class="form-control" style="width:130px;height:33px">
                <option value="">全部</option>
                #foreach(${_itemType} in ${orderItemType})
                <option value="$!{_itemType.value}" hassubinfo="true">$!{_itemType.name}</option>
                #end
            </select>
            <label>明细时间</label>
            <input class="form-control layer-date" name="createdAtStart" id="createdAtStart" placeholder="开始时间" onclick="laydate({istime: true, format: 'YYYY-MM-DD'})">
            -<input class="form-control layer-date" name="createdAtEnd" id="createdAtEnd" placeholder="结束时间" onclick="laydate({istime: true, format: 'YYYY-MM-DD'})">
        </div>
        <button class="btn btn-white" type="button" onclick="searchList('1')"><i class="glyphicon glyphicon-search"></i>查询</button>
        <button class="btn btn-info" type="button" onclick="exportList()"><i class="glyphicon glyphicon-export"></i>导出</button>
    </form>
</div>
<div>
    <div class="jqGrid_wrapper">
        <table id="table_list_1"></table>
        <div id="pager_list_1"></div>
    </div>
</div>

<script>
  function searchList(page){
       $('#table_list_1').jqGrid('setGridParam',{
            url:'queryAcctDetail.html',
            postData: getParams(),
            page:page
       }).trigger("reloadGrid");
   }
   $(document).ready(function () {
       $.jgrid.defaults.styleUI = 'Bootstrap';
       $("#createdAtStart").val(laydate.now(-1));
       $("#createdAtEnd").val(laydate.now());
       $('#table_list_1').jqGrid({
              url:'queryAcctDetail.html',
              datatype: "json",
              height: jqGridHeight,
              postData: getParams(),
              autowidth: true,
              shrinkToFit: true,
              viewrecords:true,
              rowNum: 20,
              rowList: [20, 30, 50],
              colNames: ['用户名','真实姓名','明细内容','变动类型','金额','变动原因','备注','变动时间'],
              colModel: [
                 {
                   name: 'userName',
                   width : 10
                 },
                 {
                    name: 'realName',
                    width: 10
                 },
                 {
                   name: 'accountDetailName',
                   width: 20
                  },
                 {
                   name: 'type',
                   width: 8,
                      formatter:function(cellvalue){
                        if(cellvalue=='1')
                            return "收入";
                        else
                            return "支出";
                      }
                  },
                  {
                      name: 'payFee',
                      width: 5,
                      formatter:function(value, options, rowObject){
                      if(rowObject.type=='1'){
                        return (parseFloat(rowObject.chargeFee)/parseFloat(100)).toFixed(2);
                      }else{
                       return (parseFloat(value)/parseFloat(100)).toFixed(2);
                      }
                      }
                  },
                  {
                      name: 'itemType',
                      width: 10
                  },
                  {
                      name: 'remark',
                      width: 10
                  },
                  {
                      name: 'createdAt',
                      width: 12,
                      formatter:formatDate
                  }
              ],
              pager: "#pager_list_1"
         });
   });
    function getParams(){
        var data=$('#accountDetailForm').serialize();
        data= decodeURIComponent(data,true);
        return formToJson(data);
    }
   function formToJson(data) {
       data=data.replace(/&/g,"\",\"");
       data=data.replace(/=/g,"\":\"");
       data="{\""+data+"\"}";
       var json =  eval('(' + data + ')');
       return json;
    }
   var exportList = function(){
        window.open("exportList.html?" + $('#accountDetailForm').serialize());
   }
    function formatDate(cellvalue)   {
      var date = new Date(cellvalue);
        var y = date.getFullYear();
        var m = date.getMonth() + 1;
        m = m < 10 ? ('0' + m) : m;
        var d = date.getDate();
        d = d < 10 ? ('0' + d) : d;
        var h = date.getHours();
        h = h < 10 ? ('0' + h) : h;
        var minute = date.getMinutes();
        var second = date.getSeconds();
        minute = minute < 10 ? ('0' + minute) : minute;
        second = second < 10 ? ('0' + second) : second;
        return y + '-' + m + '-' + d+' '+h+':'+minute+':'+second;
    }
</script>