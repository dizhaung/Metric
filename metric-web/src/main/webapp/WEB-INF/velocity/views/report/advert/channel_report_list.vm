<script src="${rc.contextPath}/_resources/js/plugins/layer/laydate/laydate.js"></script>
 <div class="ibox-content">
    <form role="form" class="form-inline">
        <div class="form-group">
            <label>渠道名称:</label><input type="text" id="channelName" class="form-control">
            <label>渠道主:</label><input type="text" id="userName" class="form-control">
            <label>时间范围:</label>
            <input class="form-control layer-date" id="startDate" value="$!{startDate}" placeholder="开始时间" onclick="laydate({istime: true, format: 'YYYY-MM-DD'})">
            <input class="form-control layer-date" id="endDate" value="$!{endDate}" placeholder="结束时间" onclick="laydate({istime: true, format: 'YYYY-MM-DD'})">
        </div>
        <button class="btn btn-white" type="button" onclick="searchList('1')"><i class="glyphicon glyphicon-search"></i>查询</button>
        #if($permissionTool.hasPermission('data.channel.import'))
            <button class="btn btn-warning" type="button" onclick="importPage()"><i class="glyphicon glyphicon-import"></i>导入数据</button>
        #end
        <button class="btn btn-info" type="button" onclick="exportData()"><i class="glyphicon glyphicon-export"></i>导出</button>
    </form>
  </div>
  <div class="jqGrid_wrapper ">
     <table id="table_list_1"></table>
     <div id="pager_list_1"></div>
  </div>
<script>
    function searchList(page){
         $("#table_list_1").jqGrid('setGridParam',{
              url:'channelReportJson.html?'+getParams(),
              page:page
         }).trigger("reloadGrid");
    }
    function getParams(){
        var userName=$("#userName").val();
        var channelName=$("#channelName").val();
        var startDate=$("#startDate").val();
        var endDate=$("#endDate").val();
        if("" != endDate){
           endDate = endDate + ' 23:59:59';
        }
        return "userName="+userName+"&channelName="+channelName+"&startDate="+startDate+"&endDate="+endDate;
    }
   $(document).ready(function () {
       $.jgrid.defaults.styleUI = 'Bootstrap';
       $('#table_list_1').jqGrid({
              url:'channelReportJson.html?'+getParams(),
              datatype: "json",
              height: jqGridHeight-50,
              autowidth: true,
              shrinkToFit: true,
              viewrecords : true,
              rowNum: 20,
              rowList: [20, 30, 50],
              footerrow : true,
              userDataOnFooter : true,
              colNames: ['渠道名称','渠道主','渠道编号','结算方式','结算指标','数值','操作'],
              colModel: [
                 {
                    name: 'channelName',
                    width: 10
                 },
                 {
                     name: 'channelUserName',
                     width: 10
                  },
                  {
                    name: 'channelCode',
                    width: 10
                  },
                  {
                    name: 'settleMethodName',
                    width: 10
                  },
                   {
                    name: 'settleTarget',
                    width: 10
                  },
                   {
                    name: 'flowTypeNum',
                    width: 10
                 },
                 {
                     name:'',
                     width:5,
                     formatter : function(value, options, rowObject) {
                         return '<a href="javascript:void(0)" onclick="viewDetail(\'' + rowObject.channelId + '\',\'' + rowObject.settleMethod + '\')" class="btn btn-primary" ><i class="glyphicon glyphicon-eye-open"></i>详情</a>';
                     }
                  }
              ],
              pager: "#pager_list_1"
         });
   });
   function viewDetail(channelId,settleMethod){
     var width = (document.body.clientWidth-220)+"px";
     layer.open({
       type: 2,
       area: [width, '100%'],
       offset: ['0px', '220px'],
       fixed: false,
       maxmin: true,
       title: '渠道数据',
       shadeClose: true,
       content: 'channelReportDetail.html?channelId='+channelId+"&settleMethod="+settleMethod+"&startDate="+$("#startDate").val()+"&endDate="+$("#endDate").val()
      });
    }

    function importPage(){
        layer.open({
            type: 2,
            title: '数据导入',
            shadeClose: true,
            shade: false,
            maxmin: false, //开启最大化最小化按钮
            area: ['500px', '300px'],
            content: 'importPage.html'
        });
    }

    function exportData(){
        window.location.href="exportChannelReport.html?"+getParams();
    }
</script>
</html>