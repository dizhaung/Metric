<div class="ibox-content">
    <form role="form" class="form-inline">
        <div class="form-group">
            <label>目标名称:</label><input type="text" id="targetName" class="form-control">
        </div>
        <br><br>
        <div class="form-group">
           <button class="btn btn-white" type="button" onclick="searchList('1')"><i class="glyphicon glyphicon-search"></i>查询</button>
            <button class="btn btn-success" type="button" onclick="add()"><i class="glyphicon glyphicon-plus"></i>创建业务目标</button>
        </div>
    </form>
  </div>
  <div class="jqGrid_wrapper">
        <table id="table_list_1"></table>
        <div id="pager_list_1"></div>
   </div>
 <script>
  function searchList(page){
       $("#table_list_1").jqGrid('setGridParam',{
            url:'listjson.html?'+getParams(),
            page:page
       }).trigger("reloadGrid");
   }
   function getParams(){
      var targetName=$("#targetName").val();
      return "targetName="+targetName;
   }
   $(document).ready(function () {
       $.jgrid.defaults.styleUI = 'Bootstrap';
       $('#table_list_1').jqGrid({
              url:'listjson.html?'+getParams(),
              datatype: "json",
              height: jqGridHeight,
              autowidth: true,
              shrinkToFit: true,
              viewrecords:true,
              rowNum: 20,
              rowList: [20, 30, 50],
              viewrecords : true,
              colNames: ['目标名称','所属业务','开始时间','结束时间','创建人','修改时间','操作'],
              colModel: [
                 {
                   name: 'targetName',
                   width: 10
                 },
                 {
                    name: 'busiDomain',
                    width: 10
                 },
                 {
                       name: 'startDate',
                       width: 10
                  },
                  {
                      name: 'endDate',
                      width: 10
                  },
                   {
                      name: 'createUserName',
                      width: 12
                    },
                  {
                    name: 'updateAtStr',
                    width: 10
                  },

                  {
                   name:'targetId',
                   width:10,
                   formatter : function(value, options, rowObject) {
                       var b = '';
                      //b = '<a href="javascript:void(0)" onclick="edit(\'' + value + '\')" class="btn btn-primary" ><i class="glyphicon glyphicon-pencil"></i>编辑</a>';
                        b =b+ '&nbsp;&nbsp;<a onclick="deleteTarget(\'' + rowObject.targetId + '\')" class="btn btn-danger "><i class="glyphicon glyphicon-remove"></i>删除</a>';
                        return b;
                    }
                  }
              ],
              pager: "#pager_list_1"
         });
   });
 function edit(targetId){
     var width = (document.body.clientWidth-220)+"px";
   layer.open({
     type: 2,
     area: [width, '100%'],
     offset: ['0px', '220px'],
     fixed: false,
     maxmin: true,
     content: 'toEdit.html?targetId='+targetId
    });
  }
   function add(){
     var width = (document.body.clientWidth-220)+"px";
     layer.open({
       type: 2,
     area: [width, '100%'],
     offset: ['0px', '220px'],
       fixed: false,
       maxmin: true,
       content: 'toEdit.html'
      });
    }
     function deleteTarget(targetId){
               layer.confirm('确认执行该操作？',{icon: 3, title:'删除指标预览'}, function(){
               $.ajax({
                     type: "POST",
                     url:"deleteTarget.html?targetId="+targetId,
                     dataType:"json",
                     success: function(data) {
                        if(data.code == 1){
                           searchList();
                           closeLayer(data.msg);
                        }else{
                           layer.msg(data.msg,failIcon);
                       }
                    }
                });
               }, function(){
                layer.closeAll();
              });
            }
</script>