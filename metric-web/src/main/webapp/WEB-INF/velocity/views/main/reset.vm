<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    #parse("/layout/fragments/js_css.vm")
    <script src="${rc.contextPath}/_resources/js/jquery.md5.js"></script>
</head>
<body class="gray-bg">
<div class="ibox-content">
    <form class="form-horizontal" id="form1">
        <div class="form-group">
            <label class="col-sm-3 control-label">旧密码：</label>
            <div class="col-sm-8">
                <input type="hidden" name="oldPwd" id="oldPwd">
                <input type="password" class="form-control" id="oldPwdTxt" style="width:400px">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">新密码：</label>
            <div class="col-sm-8">
                <input type="hidden" name="newPwd" id="newPwd">
                <input type="password" class="form-control" id="newPwdTxt" style="width:400px">
            </div>
        </div>
        <div class="form-group">
            <label class="col-sm-3 control-label">再次输入新密码：</label>
            <div class="col-sm-8">
                <input type="password" class="form-control" id="newPwdTxt1" style="width:400px">
            </div>
        </div>
        <div align="center">
            <button class="btn btn-success" type="button" onclick="updateAdmin()"><i class="glyphicon glyphicon-ok"></i>保存</button>
            <button class="btn btn-white" type="button" onclick="closeLayer('0')"><i class="glyphicon glyphicon-remove"></i>返回</button>
        </div>
    </form>
</div>
<script>
  function closeLayer(reload){
     if("1" == reload){
        parent.location.reload();
     }
     var index = parent.layer.getFrameIndex(window.name);
     parent.layer.close(index);
  }
  function updateAdmin(){
    var oldPwdTxt = $('#oldPwdTxt').val();
    var newPwdTxt = $('#newPwdTxt').val();
    var newPwdTxt1 = $('#newPwdTxt1').val();
    if (oldPwdTxt == "") {
        parent.layer.msg("请输入旧密码",failIcon);
        return;
    }
    if (newPwdTxt == "") {
        parent.layer.msg("请输入新密码",failIcon);
        return;
    }
    if (newPwdTxt1 == "") {
        parent.layer.msg("请再次输入新密码",failIcon);
        return;
    }
    if (newPwdTxt != newPwdTxt1) {
        parent.layer.msg("密码不一致",failIcon);
        return;
    }
    $("#oldPwd").val($.md5($("#oldPwdTxt").val()));
    $("#newPwd").val($.md5($("#newPwdTxt").val()));
     $.ajax({
        type: "POST",
        url:"/admin/resetPwd.html",
        data:$('#form1').serialize(),
        success: function(data) {
           data = eval('(' + data + ')');
           if(data.code == 1){
               window.location.href=data.data;
           } else {
               parent.layer.msg(data.msg,failIcon);
           }
        }
    });
  }
</script>
</body>
</html>