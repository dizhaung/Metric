<link href="${rc.contextPath}/_resources/css/bootstrap-select.css" rel="stylesheet">
<script src="${rc.contextPath}/_resources/js/bootstrap-select.js"></script>
<div class="ibox-content">
   <form class="form-horizontal" id="form1">
         <div class="form-group">
             <input type="hidden" name="stlOrderDtId" value="$!{entity.stlOrderDtId}">
             <label class="col-sm-3 control-label">当前核减比例（%）：$!{entity.auditRate}</label>
             <label class="col-sm-3 control-label">当前结算金额：$!{entity.finalPrice}</label>
         </div>
         <div class="form-group">
              <label class="col-sm-3 control-label">调后核减比例（%）：</label>
             <div class="col-sm-8">
                 <input id="auditRate" type="text" class="form-control" name="auditRate" value="$!{entity.auditRate}" style="width:350px" onkeyup="value=value.replace(/[^\d.]/g,'')" maxlength="8">
             </div>
          </div>
           <div class="form-group">
               <label class="col-sm-3 control-label">调后结算金额：</label>
               <div class="col-sm-8">
                   <input id="finalPrice" type="text" class="form-control" name="finalPrice" value="$!{entity.finalPrice}" style="width:350px" onkeyup="value=value.replace(/[^\d.]/g,'')" maxlength="8">
               </div>
           </div>
        <div align="center">
           <button class="btn btn-white" type="button" onclick="save()">保存</button>
           <button class="btn btn-white" type="button" onclick="parent.closeLayer()">返回</button>
        </div>
     </form>
 </div>
 <script>
  function save(){
      var auditRate=$("#auditRate").val();
      if(auditRate>100){
          layer.confirm('核减比例确定更改为'+auditRate+"吗？", {
              btn: ['确定','取消'] //按钮
          }, function(){
              doSubmit();
          }, function(){

          });
          return;
      }
      doSubmit();
  }

  var calPrice = (($!{entity.finalPrice}/$!{entity.auditRate})*100).toFixed(2);

  var o_1 = document.getElementById("auditRate");
  var o_2 = document.getElementById("finalPrice");
  o_1.onkeyup = function(){
      o_2.value = (calPrice*o_1.value/100).toFixed(2);
  }

  o_2.onkeyup = function(){
      o_1.value = (o_2.value/calPrice*100).toFixed(2);
  }

  function doSubmit() {
      $.ajax({
          type: "POST",
          url:"updateAdvStlOrdDetail.html",
          dataType:"json",
          data:$('#form1').serialize(),
          success: function(data) {
              if(data.code == 1){
                  parent.refreshSubgrid(data.data);
                  parent.closeLayer(data.msg);
              }else{
                  parent.layer.msg(data.msg,failIcon);
              }
          }
      });
  }
</script>
</html>